---
import '../styles/global.css';

interface Props {
  title: string;
  description?: string;
  ogType?: 'website' | 'article';
  ogImage?: string;
  twitterCard?: 'summary' | 'summary_large_image';
  structuredData?: Record<string, unknown> | Array<Record<string, unknown>>;
}

const {
  title,
  description = 'Daily feed archive by Romulus',
  ogType = 'website',
  ogImage,
  twitterCard = 'summary_large_image',
  structuredData
} = Astro.props;

const pathname = Astro.url.pathname;
const canonicalUrl = Astro.site ? new URL(pathname, Astro.site).toString() : Astro.url.toString();
const absoluteOgImage = ogImage ? (Astro.site ? new URL(ogImage, Astro.site).toString() : ogImage) : undefined;
const siteName = 'Romulus';

const navItems = [
  { href: '/', label: 'Home' },
  { href: '/blogs/', label: 'Blogs' },
  { href: '/archive/', label: 'Past content' },
  { href: '/subscribe/', label: 'Subscribe' }
];

const isActivePath = (href: string) => {
  if (href === '/') return pathname === '/';
  return pathname.startsWith(href);
};
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <meta name="description" content={description} />
    <meta name="robots" content="index,follow" />
    <link rel="canonical" href={canonicalUrl} />

    <meta property="og:type" content={ogType} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:url" content={canonicalUrl} />
    <meta property="og:site_name" content={siteName} />
    {absoluteOgImage && <meta property="og:image" content={absoluteOgImage} />}

    <meta name="twitter:card" content={absoluteOgImage ? twitterCard : 'summary'} />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    {absoluteOgImage && <meta name="twitter:image" content={absoluteOgImage} />}

    {
      structuredData
        ? Array.isArray(structuredData)
          ? structuredData.map((entry) => <script type="application/ld+json" set:html={JSON.stringify(entry)} />)
          : <script type="application/ld+json" set:html={JSON.stringify(structuredData)} />
        : null
    }

    <title>{title}</title>
  </head>
  <body>
    <header class="border-b border-border/80 bg-background/95 backdrop-blur">
      <div class="app-layout py-5">
        <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
          <a href="/" class="text-lg font-semibold tracking-tight">Romulus</a>
          <nav aria-label="Main navigation" class="-mx-1 flex flex-wrap items-center gap-x-1 gap-y-2 text-sm">
            {
              navItems.map((item) => (
                <a
                  href={item.href}
                  class:list={[
                    'rounded-md px-2 py-1 transition-colors hover:bg-muted/65',
                    isActivePath(item.href) && 'active-nav'
                  ]}
                >
                  {item.label}
                </a>
              ))
            }
          </nav>
        </div>
      </div>
    </header>

    <main class="flex-1">
      <div class="app-layout py-10">
        <slot />
      </div>
    </main>
  </body>
</html>
