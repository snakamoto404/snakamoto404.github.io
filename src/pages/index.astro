---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';

const entries = await getCollection('archive');
const blogEntries = await getCollection('blogs');
const toIsoDate = (value: Date) => value.toISOString().slice(0, 10);
const latest = [...entries]
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
  .slice(0, 7);
const latestBlogs = [...blogEntries]
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
  .slice(0, 5);
---

<BaseLayout title="Home | snakamoto404.github.io">
  <section class="space-y-6">
    <div class="space-y-2">
      <h1 class="text-3xl font-semibold tracking-tight">Daily Feed Archive</h1>
      <p class="text-sm text-foreground/80">Markdown-backed daily entries with clean, stable permalinks.</p>
    </div>

    <div class="panel space-y-3">
      <p>
        This archive publishes each day to <code>/archive/YYYY-MM-DD/</code> with source files in
        <code>src/content/archive/</code>.
      </p>
      <p>
        Manage email updates at <a href="/subscribe/">/subscribe</a> and <a href="/unsubscribe/">/unsubscribe</a>.
      </p>
    </div>

    <section class="space-y-3">
      <h2 class="text-xl font-semibold tracking-tight">Latest</h2>
      {
        latest.length ? (
          <ul class="space-y-3">
            {latest.map((entry) => (
              <li class="panel">
                <a href={`/archive/${toIsoDate(entry.data.date)}/`} class="text-base font-semibold hover:text-accent">
                  {toIsoDate(entry.data.date)}
                </a>
                <p class="mt-2 text-sm text-foreground/85">{entry.data.summary ?? 'No summary provided.'}</p>
              </li>
            ))}
          </ul>
        ) : (
          <div class="panel">
            <p>No entries yet. Check back soon.</p>
          </div>
        )
      }
    </section>

    <section class="space-y-3">
      <h2 class="text-xl font-semibold tracking-tight">Blogs</h2>
      {
        latestBlogs.length ? (
          <ul class="space-y-3">
            {latestBlogs.map((entry) => (
              <li class="panel">
                <a href={`/blogs/${entry.slug}/`} class="text-base font-semibold hover:text-accent">
                  {entry.data.title}
                </a>
                <p class="mt-2 text-sm text-foreground/80">
                  <strong>Date:</strong> <time datetime={toIsoDate(entry.data.date)}>{toIsoDate(entry.data.date)}</time>
                </p>
                <p class="mt-2 text-sm text-foreground/85">{entry.data.summary ?? 'No summary provided.'}</p>
              </li>
            ))}
          </ul>
        ) : (
          <div class="panel">
            <p>No blog posts yet.</p>
          </div>
        )
      }
      <p class="text-sm">
        <a href="/blogs/" class="font-medium">Browse all blogs -></a>
      </p>
    </section>

    <p class="text-sm">
      <a href="/archive/" class="font-medium">Browse all entries -></a>
    </p>
  </section>
</BaseLayout>
