---
import type { CollectionEntry } from 'astro:content';
import { getCollection } from 'astro:content';
import GiscusComments from '../../components/GiscusComments.astro';
import BaseLayout from '../../layouts/BaseLayout.astro';

export async function getStaticPaths() {
  const entries = await getCollection('archive');

  const toIsoDate = (value: Date) => value.toISOString().slice(0, 10);

  return entries.map((entry) => ({
    params: { date: toIsoDate(entry.data.date) },
    props: { entry }
  }));
}

interface Props {
  entry: CollectionEntry<'archive'>;
}

const { entry } = Astro.props;
const { Content } = await entry.render();
const toIsoDate = (value: Date) => value.toISOString().slice(0, 10);
const isoDate = toIsoDate(entry.data.date);
---

<BaseLayout title={`${isoDate} | Past content`} description={entry.data.summary}>
  <article class="panel space-y-5">
    <p class="text-sm">
      <a href="/archive/" class="font-medium">Back to past content</a>
    </p>

    <header class="space-y-2 border-b border-border/80 pb-4">
      <h1 class="text-2xl font-semibold tracking-tight">{entry.data.title}</h1>
      <p class="text-sm text-foreground/80">
        <strong>Date:</strong> <time datetime={isoDate}>{isoDate}</time>
      </p>
    </header>

    <div class="app-prose">
      <Content />
    </div>
  </article>

  <GiscusComments />
</BaseLayout>
